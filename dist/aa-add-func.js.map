{"version":3,"sources":["../src/aa-add-func.js"],"names":["aaAddFunc","$compile","inputTemplate","buttonTemplate","link","$scope","elem","categories","aafunc","getCategories","allFunctions","getAllFunctionNames","functionMenu","createFunctionDropDownMenu","$input","$button","appendTo","attr","typeahead","source","minLength","items","updater","value","funcDef","getFuncDef","toLowerCase","_","find","funcName","indexOf","$apply","addFunction","trigger","click","hide","show","focus","keyup","toggleClass","val","blur","setTimeout","removeClass","contents","coreModule","directive","reduce","list","category","each","func","push","name","map","text","submenu"],"mappings":"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","sourcesContent":["import _ from 'lodash';\nimport $ from 'jquery';\n\nimport coreModule from 'app/core/core_module';\nimport * as aafunc from './aafunc';\n\n/** @ngInject */\nexport function aaAddFunc($compile) {\n  var inputTemplate = '<input type=\"text\"'+\n                        ' class=\"gf-form-input\"' +\n                        ' spellcheck=\"false\" style=\"display:none\"></input>';\n\n  var buttonTemplate = '<a  class=\"gf-form-label tight-form-func dropdown-toggle query-part\"' +\n                          ' tabindex=\"1\" gf-dropdown=\"functionMenu\" data-toggle=\"dropdown\">' +\n                          '<i class=\"fa fa-plus\"></i></a>';\n\n  return {\n    link: function($scope, elem) {\n      var categories = aafunc.getCategories();\n      var allFunctions = getAllFunctionNames(categories);\n\n      $scope.functionMenu = createFunctionDropDownMenu(categories);\n\n      var $input = $(inputTemplate);\n      var $button = $(buttonTemplate);\n      $input.appendTo(elem);\n      $button.appendTo(elem);\n\n      $input.attr('data-provide', 'typeahead');\n      $input.typeahead({\n        source: allFunctions,\n        minLength: 1,\n        items: 10,\n        updater: function (value) {\n          var funcDef = aafunc.getFuncDef(value);\n          if (!funcDef) {\n            // try find close match\n            value = value.toLowerCase();\n            funcDef = _.find(allFunctions, function(funcName) {\n              return funcName.toLowerCase().indexOf(value) === 0;\n            });\n\n            if (!funcDef) { return; }\n          }\n\n          $scope.$apply(function() {\n            $scope.addFunction(funcDef);\n          });\n\n          $input.trigger('blur');\n          return '';\n        }\n      });\n\n      $button.click(function() {\n        $button.hide();\n        $input.show();\n        $input.focus();\n      });\n\n      $input.keyup(function() {\n        elem.toggleClass('open', $input.val() === '');\n      });\n\n      $input.blur(function() {\n        // clicking the function dropdown menu won't\n        // work if you remove class at once\n        setTimeout(function() {\n          $input.val('');\n          $input.hide();\n          $button.show();\n          elem.removeClass('open');\n        }, 200);\n      });\n\n      $compile(elem.contents())($scope);\n    }\n  };\n};\n\ncoreModule.directive('aaAddFunc', aaAddFunc);\n\nfunction getAllFunctionNames(categories) {\n  return _.reduce(categories, function(list, category) {\n    _.each(category, function(func) {\n      list.push(func.name);\n    });\n    return list;\n  }, []);\n}\n\nfunction createFunctionDropDownMenu(categories) {\n  return _.map(categories, function(list, category) {\n    return {\n      text: category,\n      submenu: _.map(list, function(value) {\n        return {\n          text: value.name,\n          click: \"ctrl.addFunction('\" + value.name + \"')\",\n        };\n      })\n    };\n  });\n}\n"],"file":"aa-add-func.js"}