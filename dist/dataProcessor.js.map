{"version":3,"sources":["../src/dataProcessor.js"],"names":["scale","factor","datapoints","_","map","point","offset","delta","newSeries","i","length","deltaValue","push","fluctuation","flucValue","transformWrapper","func","args","funcArgs","slice","timeseriesData","tsData","timeseries","Promise","resolve","datapointsAvg","meanBy","datapointsMin","minPoint","minBy","datapointsMax","maxPoint","maxBy","datapointsSum","sumBy","datapointsAbsMin","Math","abs","datapointsAbsMax","datapointsAggFuncs","avg","min","max","sum","absoluteMin","absoluteMax","extraction","order","n","orderFunc","orderByCallback","sortByIteratee","ts","sortedTsData","sortBy","reverse","functions","partial","top","bottom","aaFunctions"],"mappings":"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","sourcesContent":["import _ from 'lodash';\n\n// Transform\n\nfunction scale(factor, datapoints) {\n  return _.map(datapoints, (point) => (\n    [point[0] * factor, point[1]]\n  ));\n}\n\nfunction offset(delta, datapoints) {\n  return _.map(datapoints, (point) => (\n    [point[0] + delta, point[1]]\n  ));\n}\n\nfunction delta(datapoints) {\n  const newSeries = [];\n  for (let i = 1; i < datapoints.length; i += 1) {\n    const deltaValue = datapoints[i][0] - datapoints[i - 1][0];\n    newSeries.push([deltaValue, datapoints[i][1]]);\n  }\n  return newSeries;\n}\n\nfunction fluctuation(datapoints) {\n  const newSeries = [];\n  for (let i = 0; i < datapoints.length; i += 1) {\n    const flucValue = datapoints[i][0] - datapoints[0][0];\n    newSeries.push([flucValue, datapoints[i][1]]);\n  }\n  return newSeries;\n}\n\n// [Support Funcs] Transform wrapper\n\nfunction transformWrapper(func, ...args) {\n  const funcArgs = args.slice(0, -1);\n  const timeseriesData = args[args.length - 1];\n\n  const tsData = _.map(timeseriesData, (timeseries) => {\n    timeseries.datapoints = func(...funcArgs, timeseries.datapoints);\n    return timeseries;\n  });\n\n  return Promise.resolve(tsData);\n}\n\n// Filter Series\n\n// [Support Funcs] Datapoints aggregation functions\n\nfunction datapointsAvg(datapoints) {\n  return _.meanBy(datapoints, (point) => point[0]);\n}\n\nfunction datapointsMin(datapoints) {\n  const minPoint = _.minBy(datapoints, (point) => point[0]);\n  return minPoint[0];\n}\n\nfunction datapointsMax(datapoints) {\n  const maxPoint = _.maxBy(datapoints, (point) => point[0]);\n  return maxPoint[0];\n}\n\nfunction datapointsSum(datapoints) {\n  return _.sumBy(datapoints, (point) => point[0]);\n}\n\nfunction datapointsAbsMin(datapoints) {\n  const minPoint = _.minBy(datapoints, (point) => Math.abs(point[0]));\n  return Math.abs(minPoint[0]);\n}\n\nfunction datapointsAbsMax(datapoints) {\n  const maxPoint = _.maxBy(datapoints, (point) => Math.abs(point[0]));\n  return Math.abs(maxPoint[0]);\n}\n\nconst datapointsAggFuncs = {\n  avg: datapointsAvg,\n  min: datapointsMin,\n  max: datapointsMax,\n  sum: datapointsSum,\n  absoluteMin: datapointsAbsMin,\n  absoluteMax: datapointsAbsMax,\n};\n\n// [Support Funcs] Wrapper function for top and bottom function\n\nfunction extraction(order, n, orderFunc, timeseriesData) {\n  const orderByCallback = datapointsAggFuncs[orderFunc];\n  const sortByIteratee = (ts) => (\n    orderByCallback(ts.datapoints)\n  );\n\n  const sortedTsData = _.sortBy(timeseriesData, sortByIteratee);\n  if (order === 'bottom') {\n    return _.slice(sortedTsData, 0, n);\n  }\n\n  return _.reverse(_.slice(sortedTsData, -n));\n}\n\n// Function list\n\nconst functions = {\n  // Transform\n  scale: _.partial(transformWrapper, scale),\n  offset: _.partial(transformWrapper, offset),\n  delta: _.partial(transformWrapper, delta),\n  fluctuation: _.partial(transformWrapper, fluctuation),\n  // Filter Series\n  top: _.partial(extraction, 'top'),\n  bottom: _.partial(extraction, 'bottom'),\n};\n\nexport default {\n  get aaFunctions() {\n    return functions;\n  },\n};\n"],"file":"dataProcessor.js"}